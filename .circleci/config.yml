version: '2.1'

orbs:
  aws-ecr: circleci/aws-ecr@6.5.0
  go: circleci/go@0.2.0

machine: &machine
  # Run docker-compose on the VM
  machine:
    image: circleci/classic:201808-01
    docker_layer_caching: true
  working_directory: /tmp/workspace/project

jobs:
  test:
    <<: *machine
    steps:
      - checkout
      - go/install
      - run:
          name: Run unit tests
          command: make gotest

workflows:
  build-and-push:
    jobs:
      - test
